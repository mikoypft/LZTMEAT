# Enable mod_rewrite
RewriteEngine On
RewriteBase /

# Serve existing static files directly (CSS, JS, images, etc.)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Route /api requests to Laravel backend
RewriteCond %{REQUEST_URI} ^/api
RewriteRule ^api/(.*)$ ../backend/public/index.php/$1 [QSA,L]

# SPA fallback: route all non-file requests to index.html (React Router)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [QSA,L]

# ============================================================================
# MIME TYPES
# ============================================================================
AddType application/javascript js mjs
AddType text/css css
AddType image/svg+xml svg
AddType application/json json

# ============================================================================
# HEADERS
# ============================================================================
<IfModule mod_headers.c>
  <FilesMatch "\.(js|mjs)$">
    Header set Content-Type "application/javascript; charset=utf-8"
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  <FilesMatch "\.css$">
    Header set Content-Type "text/css; charset=utf-8"
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  <FilesMatch "\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
  </FilesMatch>

  Header set X-Content-Type-Options "nosniff"
</IfModule>
